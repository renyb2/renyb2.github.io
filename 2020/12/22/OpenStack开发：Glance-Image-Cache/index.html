<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>OpenStack开发：Glance Image Cache | 任翌博的个人博客</title><meta name="description" content="The Glance Image Cache The Glance API server may be configured to have an optional local image cache. A local image cache stores a copy of image files, essentially enabling multiple API servers to ser"><meta name="keywords" content="Train版本,OpenStack开发,Glance"><meta name="author" content="任翌博"><meta name="copyright" content="任翌博"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://renyb2.github.io/2020/12/22/OpenStack%E5%BC%80%E5%8F%91%EF%BC%9AGlance-Image-Cache/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="OpenStack开发：Glance Image Cache"><meta property="og:url" content="https://renyb2.github.io/2020/12/22/OpenStack%E5%BC%80%E5%8F%91%EF%BC%9AGlance-Image-Cache/"><meta property="og:site_name" content="任翌博的个人博客"><meta property="og:description" content="The Glance Image Cache The Glance API server may be configured to have an optional local image cache. A local image cache stores a copy of image files, essentially enabling multiple API servers to ser"><meta property="og:image" content="https://www.pinclipart.com/picdir/big/201-2017709_a-quick-study-guide-for-the-coa-exam.png"><meta property="article:published_time" content="2020-12-22T02:49:59.000Z"><meta property="article:modified_time" content="2020-12-22T07:25:04.526Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-12-22 15:25:04'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="任翌博的个人博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Glance-Image-Cache"><span class="toc-number">1.</span> <span class="toc-text">The Glance Image Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration-options-for-the-Image-Cache"><span class="toc-number">2.</span> <span class="toc-text">Configuration options for the Image Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Managing-the-Glance-Image-Cache"><span class="toc-number">3.</span> <span class="toc-text">Managing the Glance Image Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Glance-Image-Cache-API"><span class="toc-number">3.1.</span> <span class="toc-text">Glance Image Cache API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.</span> <span class="toc-text">数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlite%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.1.</span> <span class="toc-text">sqlite数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Glance-image-cache%E6%B5%81%E7%A8%8B"><span class="toc-number">5.1.</span> <span class="toc-text">Glance image cache流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Glance-image-cache%E6%B8%85%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text">Glance image cache清理流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number">6.</span> <span class="toc-text">参考文档</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://www.pinclipart.com/picdir/big/201-2017709_a-quick-study-guide-for-the-coa-exam.png)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">任翌博的个人博客</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">OpenStack开发：Glance Image Cache</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-22T02:49:59.000Z" title="发表于 2020-12-22 10:49:59">2020-12-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-22T07:25:04.526Z" title="更新于 2020-12-22 15:25:04">2020-12-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OpenStack%E5%BC%80%E5%8F%91/">OpenStack开发</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="The-Glance-Image-Cache"><a href="#The-Glance-Image-Cache" class="headerlink" title="The Glance Image Cache"></a>The Glance Image Cache</h2><blockquote>
<p>The Glance API server may be configured to have an optional local image cache. A local image cache stores a copy of image files, essentially enabling multiple API servers to serve the same image file, resulting in an increase in scalability due to an increased number of endpoints serving an image file.</p>
<p>This local image cache is transparent to the end user – in other words, the end user doesn’t know that the Glance API is streaming an image file from its local cache or from the actual backend storage system.</p>
</blockquote>
<h2 id="Configuration-options-for-the-Image-Cache"><a href="#Configuration-options-for-the-Image-Cache" class="headerlink" title="Configuration options for the Image Cache"></a>Configuration options for the Image Cache</h2><p>Config File：<code>glance-api.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"><span class="comment"># This is the base directory where Glance stores the cache data (Required to be set, as does not have a default).</span></span><br><span class="line">image_cache_dir = /var/lib/glance/image-cache</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the sqlite file database that will be used for cache management.</span></span><br><span class="line">image_cache_driver = sqlite</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a relative path from the image_cache_dir directory (Default:cache.db)</span></span><br><span class="line">image_cache_sqlite_db = cache.db</span><br><span class="line"></span><br><span class="line"><span class="comment"># The size when the glance-cache-pruner will remove the oldest images, to reduce the bytes until under this value. (Default:10 GB)</span></span><br><span class="line">image_cache_max_size = 1073741824</span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line"><span class="comment"># Enabling the Image Cache Management Middlewar. There are three types you can chose: </span></span><br><span class="line"><span class="comment">#   - cachemanagement</span></span><br><span class="line"><span class="comment">#   - keystone+cachemanagement</span></span><br><span class="line"><span class="comment">#   - trusted-auth+cachemanagement.</span></span><br><span class="line">flavor = keystone+cachemanagement</span><br></pre></td></tr></table></figure>





<h2 id="Managing-the-Glance-Image-Cache"><a href="#Managing-the-Glance-Image-Cache" class="headerlink" title="Managing the Glance Image Cache"></a>Managing the Glance Image Cache</h2><blockquote>
<p>While image files are automatically placed in the image cache on successful requests to <code>GET /v2/images/&#123;image_id&#125;/file</code>, eg: <code>openstack image save --file &lt;file name&gt; &lt;image id&gt;</code>.</p>
<p>the image cache is not automatically managed. Here, we describe the basics of how to manage the local image cache on Glance API servers and how to automate this cache management.</p>
</blockquote>
<h3 id="Glance-Image-Cache-API"><a href="#Glance-Image-Cache-API" class="headerlink" title="Glance Image Cache API"></a>Glance Image Cache API</h3><table>
<thead>
<tr>
<th>Description</th>
<th>Method</th>
<th>URL</th>
</tr>
</thead>
<tbody><tr>
<td>Get cached image</td>
<td>GET</td>
<td><code>/v2/cached_images</code></td>
</tr>
<tr>
<td>Delete cached image</td>
<td>DELETE</td>
<td><code>/v2/cached_images/&#123;image_id&#125;</code></td>
</tr>
<tr>
<td>Delete all cached image</td>
<td>DELETE</td>
<td><code>/v2/cached_images</code></td>
</tr>
<tr>
<td>Get queued image</td>
<td>GET</td>
<td><code>/v2/queued_images</code></td>
</tr>
<tr>
<td>Put image to queue</td>
<td>PUT</td>
<td><code>/v2/queued_images/&#123;image_id&#125;</code></td>
</tr>
<tr>
<td>Delete queued image</td>
<td>DELETE</td>
<td><code>/v2/queued_images/&#123;image_id&#125;</code></td>
</tr>
<tr>
<td>Delete all queued image</td>
<td>DELETE</td>
<td><code>/v2/queued_images</code></td>
</tr>
</tbody></table>
<p>Src File：<code>glance/api/middleware/cache_manage.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright 2011 OpenStack Foundation</span></span><br><span class="line"><span class="comment"># All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span></span><br><span class="line"><span class="comment">#    not use this file except in compliance with the License. You may obtain</span></span><br><span class="line"><span class="comment">#    a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">#    distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span></span><br><span class="line"><span class="comment">#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span></span><br><span class="line"><span class="comment">#    License for the specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">#    under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Image Cache Management API</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> oslo_log <span class="keyword">import</span> log <span class="keyword">as</span> logging</span><br><span class="line"><span class="keyword">import</span> routes</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> glance.api.v2 <span class="keyword">import</span> cached_images</span><br><span class="line"><span class="keyword">from</span> glance.common <span class="keyword">import</span> wsgi</span><br><span class="line"><span class="keyword">from</span> glance.i18n <span class="keyword">import</span> _LI</span><br><span class="line"></span><br><span class="line">LOG = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheManageFilter</span>(<span class="params">wsgi.Middleware</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, app</span>):</span></span><br><span class="line">        mapper = routes.Mapper()</span><br><span class="line">        resource = cached_images.create_resource()</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/cached_images&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;get_cached_images&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;GET&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/cached_images/&#123;image_id&#125;&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;delete_cached_image&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;DELETE&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/cached_images&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;delete_cached_images&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;DELETE&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/queued_images/&#123;image_id&#125;&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;queue_image&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;PUT&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/queued_images&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;get_queued_images&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;GET&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/queued_images/&#123;image_id&#125;&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;delete_queued_image&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;DELETE&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        mapper.connect(<span class="string">&quot;/v2/queued_images&quot;</span>,</span><br><span class="line">                       controller=resource,</span><br><span class="line">                       action=<span class="string">&quot;delete_queued_images&quot;</span>,</span><br><span class="line">                       conditions=dict(method=[<span class="string">&quot;DELETE&quot;</span>]))</span><br><span class="line"></span><br><span class="line">        self._mapper = mapper</span><br><span class="line">        self._resource = resource</span><br><span class="line"></span><br><span class="line">        LOG.info(_LI(<span class="string">&quot;Initialized image cache management middleware&quot;</span>))</span><br><span class="line">        super(CacheManageFilter, self).__init__(app)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="comment"># Map request to our resource object if we can handle it</span></span><br><span class="line">        match = self._mapper.match(request.path_info, request.environ)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            request.environ[<span class="string">&#x27;wsgiorg.routing_args&#x27;</span>] = (<span class="literal">None</span>, match)</span><br><span class="line">            <span class="keyword">return</span> self._resource(request)</span><br><span class="line">        <span class="comment"># Pass off downstream if we don&#x27;t match the request path</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="sqlite数据库"><a href="#sqlite数据库" class="headerlink" title="sqlite数据库"></a>sqlite数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span><br><span class="line">cached_images</span><br><span class="line">sqlite&gt; .schema cached_images</span><br><span class="line">CREATE TABLE cached_images (</span><br><span class="line">                        image_id TEXT PRIMARY KEY,</span><br><span class="line">                        last_accessed REAL DEFAULT 0.0,</span><br><span class="line">                        last_modified REAL DEFAULT 0.0,</span><br><span class="line">                        size INTEGER DEFAULT 0,</span><br><span class="line">                        hits INTEGER DEFAULT 0,</span><br><span class="line">                        checksum TEXT</span><br><span class="line">                    );</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>image_id：缓存镜像id</li>
<li>last_accessed：镜像最近一次被访问的时间</li>
<li>last_modified：镜像最近一次更改的时间</li>
<li>size：镜像大小</li>
<li>hits：镜像缓存命中次数，命中一次 +1</li>
<li>checksum：校验值</li>
</ul>
<p>Src File：<code>glance/image_cache/drivers/sqlite.py</code></p>
<p><code>SQLite Driver</code>创建表的流程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_db</span>(<span class="params">self</span>):</span></span><br><span class="line">    db = CONF.image_cache_sqlite_db</span><br><span class="line">    self.db_path = os.path.join(self.base_dir, db)</span><br><span class="line">    lockutils.set_defaults(self.base_dir)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @lockutils.synchronized(&#x27;image_cache_db_init&#x27;, external=True)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_db</span>():</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = sqlite3.connect(self.db_path, check_same_thread=<span class="literal">False</span>,</span><br><span class="line">                                   factory=SqliteConnection)</span><br><span class="line">            conn.executescript(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                CREATE TABLE IF NOT EXISTS cached_images (</span></span><br><span class="line"><span class="string">                    image_id TEXT PRIMARY KEY,</span></span><br><span class="line"><span class="string">                    last_accessed REAL DEFAULT 0.0,</span></span><br><span class="line"><span class="string">                    last_modified REAL DEFAULT 0.0,</span></span><br><span class="line"><span class="string">                    size INTEGER DEFAULT 0,</span></span><br><span class="line"><span class="string">                    hits INTEGER DEFAULT 0,</span></span><br><span class="line"><span class="string">                    checksum TEXT</span></span><br><span class="line"><span class="string">                );</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>)</span><br><span class="line">            conn.close()</span><br><span class="line">        <span class="keyword">except</span> sqlite3.DatabaseError <span class="keyword">as</span> e:</span><br><span class="line">            msg = _(<span class="string">&quot;Failed to initialize the image cache database. &quot;</span></span><br><span class="line">                    <span class="string">&quot;Got error: %s&quot;</span>) % e</span><br><span class="line">            LOG.error(msg)</span><br><span class="line">            <span class="keyword">raise</span> exception.BadDriverConfiguration(driver_name=<span class="string">&#x27;sqlite&#x27;</span>,</span><br><span class="line">                                                   reason=msg)</span><br><span class="line"></span><br><span class="line">    create_db()</span><br></pre></td></tr></table></figure>





<h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><h3 id="Glance-image-cache流程"><a href="#Glance-image-cache流程" class="headerlink" title="Glance image cache流程"></a>Glance image cache流程</h3><p>Src File：<code>glance/image_cache/__init__.py</code></p>
<p>入口函数：主要传入CHUNKSIZE值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_image_file</span>(<span class="params">self, image_id, image_file</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Cache an image file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param image_id: Image ID</span></span><br><span class="line"><span class="string">        :param image_file: Image file to cache</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :returns: True if image file was cached, False otherwise</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        CHUNKSIZE = <span class="number">64</span> * units.Mi</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.cache_image_iter(image_id,</span><br><span class="line">                                     utils.chunkiter(image_file, CHUNKSIZE))</span><br></pre></td></tr></table></figure>

<p><code>cache_image_iter()</code> &gt; <code>get_caching_iter()</code> &gt; <code>cache_tee_iter</code>，打开缓存文件写入缓存内容，文件名为<code>image_id</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_image_iter</span>(<span class="params">self, image_id, image_iter, image_checksum=None</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Cache an image with supplied iterator.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param image_id: Image ID</span></span><br><span class="line"><span class="string">    :param image_file: Iterator retrieving image chunks</span></span><br><span class="line"><span class="string">    :param image_checksum: Checksum of image</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :returns: True if image file was cached, False otherwise</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.driver.is_cacheable(image_id):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> self.get_caching_iter(image_id, image_checksum,</span><br><span class="line">                                       image_iter):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_caching_iter</span>(<span class="params">self, image_id, image_checksum, image_iter</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Returns an iterator that caches the contents of an image</span></span><br><span class="line"><span class="string">    while the image contents are read through the supplied</span></span><br><span class="line"><span class="string">    iterator.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param image_id: Image ID</span></span><br><span class="line"><span class="string">    :param image_checksum: checksum expected to be generated while</span></span><br><span class="line"><span class="string">                           iterating over image data</span></span><br><span class="line"><span class="string">    :param image_iter: Iterator that will read image contents</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.driver.is_cacheable(image_id):</span><br><span class="line">        <span class="keyword">return</span> image_iter</span><br><span class="line"></span><br><span class="line">    LOG.debug(<span class="string">&quot;Tee&#x27;ing image &#x27;%s&#x27; into cache&quot;</span>, image_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.cache_tee_iter(image_id, image_iter, image_checksum)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache_tee_iter</span>(<span class="params">self, image_id, image_iter, image_checksum</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        current_checksum = hashlib.md5()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> self.driver.open_for_write(image_id) <span class="keyword">as</span> cache_file:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> image_iter:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    cache_file.write(chunk)</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    current_checksum.update(chunk)</span><br><span class="line">                    <span class="keyword">yield</span> chunk</span><br><span class="line">            cache_file.flush()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (image_checksum <span class="keyword">and</span></span><br><span class="line">                    image_checksum != current_checksum.hexdigest()):</span><br><span class="line">                msg = _(<span class="string">&quot;Checksum verification failed. Aborted &quot;</span></span><br><span class="line">                        <span class="string">&quot;caching of image &#x27;%s&#x27;.&quot;</span>) % image_id</span><br><span class="line">                <span class="keyword">raise</span> exception.GlanceException(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> exception.GlanceException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">with</span> excutils.save_and_reraise_exception():</span><br><span class="line">            <span class="comment"># image_iter has given us bad, (size_checked_iter has found a</span></span><br><span class="line">            <span class="comment"># bad length), or corrupt data (checksum is wrong).</span></span><br><span class="line">            LOG.exception(encodeutils.exception_to_unicode(e))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        LOG.exception(_LE(<span class="string">&quot;Exception encountered while tee&#x27;ing &quot;</span></span><br><span class="line">                          <span class="string">&quot;image &#x27;%(image_id)s&#x27; into cache: %(error)s. &quot;</span></span><br><span class="line">                          <span class="string">&quot;Continuing with response.&quot;</span>) %</span><br><span class="line">                      &#123;<span class="string">&#x27;image_id&#x27;</span>: image_id,</span><br><span class="line">                       <span class="string">&#x27;error&#x27;</span>: encodeutils.exception_to_unicode(e)&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If no checksum provided continue responding even if</span></span><br><span class="line">        <span class="comment"># caching failed.</span></span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> image_iter:</span><br><span class="line">            <span class="keyword">yield</span> chunk</span><br></pre></td></tr></table></figure>



<h3 id="Glance-image-cache清理流程"><a href="#Glance-image-cache清理流程" class="headerlink" title="Glance image cache清理流程"></a>Glance image cache清理流程</h3><p>源生为一次性可执行命令，官方建议使用<code>cron</code>运行<code>glance-cache-pruner</code></p>
<p>Src File：<code>glance/image_cache/__init__.py</code></p>
<p>当前缓存文件大小与配置中的<code>image_cache_max_size</code>值进行比较，大于<code>image_cache_max_size</code>则开启清理操作，根据缓存文件的<code>last_accessed</code>字段，依次删除活跃度最低的镜像，直至缓存文件大小小于<code>image_cache_max_size</code>值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prune</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Removes all cached image files above the cache&#x27;s maximum</span></span><br><span class="line"><span class="string">    size. Returns a tuple containing the total number of cached</span></span><br><span class="line"><span class="string">    files removed and the total size of all pruned image files.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    max_size = CONF.image_cache_max_size</span><br><span class="line">    current_size = self.driver.get_cache_size()</span><br><span class="line">    <span class="keyword">if</span> max_size &gt; current_size:</span><br><span class="line">        LOG.debug(<span class="string">&quot;Image cache has free space, skipping prune...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    overage = current_size - max_size</span><br><span class="line">    LOG.debug(<span class="string">&quot;Image cache currently %(overage)d bytes over max &quot;</span></span><br><span class="line">              <span class="string">&quot;size. Starting prune to max size of %(max_size)d &quot;</span>,</span><br><span class="line">              &#123;<span class="string">&#x27;overage&#x27;</span>: overage, <span class="string">&#x27;max_size&#x27;</span>: max_size&#125;)</span><br><span class="line"></span><br><span class="line">    total_bytes_pruned = <span class="number">0</span></span><br><span class="line">    total_files_pruned = <span class="number">0</span></span><br><span class="line">    entry = self.driver.get_least_recently_accessed()</span><br><span class="line">    <span class="keyword">while</span> entry <span class="keyword">and</span> current_size &gt; max_size:</span><br><span class="line">        image_id, size = entry</span><br><span class="line">        LOG.debug(<span class="string">&quot;Pruning &#x27;%(image_id)s&#x27; to free %(size)d bytes&quot;</span>,</span><br><span class="line">                  &#123;<span class="string">&#x27;image_id&#x27;</span>: image_id, <span class="string">&#x27;size&#x27;</span>: size&#125;)</span><br><span class="line">        self.driver.delete_cached_image(image_id)</span><br><span class="line">        total_bytes_pruned = total_bytes_pruned + size</span><br><span class="line">        total_files_pruned = total_files_pruned + <span class="number">1</span></span><br><span class="line">        current_size = current_size - size</span><br><span class="line">        entry = self.driver.get_least_recently_accessed()</span><br><span class="line"></span><br><span class="line">    LOG.debug(<span class="string">&quot;Pruning finished pruning. &quot;</span></span><br><span class="line">              <span class="string">&quot;Pruned %(total_files_pruned)d and &quot;</span></span><br><span class="line">              <span class="string">&quot;%(total_bytes_pruned)d.&quot;</span>,</span><br><span class="line">              &#123;<span class="string">&#x27;total_files_pruned&#x27;</span>: total_files_pruned,</span><br><span class="line">               <span class="string">&#x27;total_bytes_pruned&#x27;</span>: total_bytes_pruned&#125;)</span><br><span class="line">    <span class="keyword">return</span> total_files_pruned, total_bytes_pruned</span><br></pre></td></tr></table></figure>





<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://docs.openstack.org/glance/train/admin/cache.html">OpenStack Documentation：The Glance Image Cache</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.openstack.org/glance/train/admin/">OpenStack Documentation：Glance Administration Guide</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.openstack.org/glance/train/configuration/configuring.html">OpenStack Documentation：Basic Configuration</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">任翌博</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://renyb2.github.io/2020/12/22/OpenStack%E5%BC%80%E5%8F%91%EF%BC%9AGlance-Image-Cache/">https://renyb2.github.io/2020/12/22/OpenStack%E5%BC%80%E5%8F%91%EF%BC%9AGlance-Image-Cache/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://renyb2.github.io" target="_blank">任翌博的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Train%E7%89%88%E6%9C%AC/">Train版本</a><a class="post-meta__tags" href="/tags/OpenStack%E5%BC%80%E5%8F%91/">OpenStack开发</a><a class="post-meta__tags" href="/tags/Glance/">Glance</a></div><div class="post_share"><div class="social-share" data-image="https://www.pinclipart.com/picdir/big/201-2017709_a-quick-study-guide-for-the-coa-exam.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/05/OpenStack%E5%BC%80%E5%8F%91%EF%BC%9AGlance-Image-Soft-Delete/"><img class="prev-cover" src="https://www.pinclipart.com/picdir/big/201-2017709_a-quick-study-guide-for-the-coa-exam.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">OpenStack开发：Glance Image Soft Delete</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/21/%E5%BC%80%E5%8F%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%9AChrome%E7%BF%BB%E5%A2%99/"><img class="next-cover" src="https://lh3.googleusercontent.com/V66_zroyuIOl9ZfuC1OgILd5C1f4cwGZvLSUeqthleyM4sw_UUjN2xw_4Ffm1XJdsImIZpcFuIRGu4ZQjfciMMOu=w640-h400-e365-rj-sc0x00ffffff" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">开发小工具：Chrome翻墙</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/01/05/OpenStack开发：Glance-Image-Soft-Delete/" title="OpenStack开发：Glance Image Soft Delete"><img class="relatedPosts_cover" src="https://www.pinclipart.com/picdir/big/201-2017709_a-quick-study-guide-for-the-coa-exam.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-05</div><div class="relatedPosts_title">OpenStack开发：Glance Image Soft Delete</div></div></a></div><div class="relatedPosts_item"><a href="/2020/12/16/OpenStack开发：novaclient解析/" title="OpenStack开发：novaclient解析"><img class="relatedPosts_cover" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1604668762480&di=d5583e78d6c7b0388d33ae09d0271f92&imgtype=0&src=http%3A%2F%2Fpic.baike.soso.com%2Fp%2F20140514%2F20140514115311-1438774487.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-16</div><div class="relatedPosts_title">OpenStack开发：novaclient解析</div></div></a></div><div class="relatedPosts_item"><a href="/2020/12/14/OpenStack开发：Curl接口调试/" title="OpenStack开发：Curl接口调试"><img class="relatedPosts_cover" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1604668762480&di=d5583e78d6c7b0388d33ae09d0271f92&imgtype=0&src=http%3A%2F%2Fpic.baike.soso.com%2Fp%2F20140514%2F20140514115311-1438774487.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-14</div><div class="relatedPosts_title">OpenStack开发：Curl接口调试</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/06/OpenStack使用：自定义实例root密码/" title="OpenStack使用：自定义实例root密码"><img class="relatedPosts_cover" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1604668762480&di=d5583e78d6c7b0388d33ae09d0271f92&imgtype=0&src=http%3A%2F%2Fpic.baike.soso.com%2Fp%2F20140514%2F20140514115311-1438774487.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-06</div><div class="relatedPosts_title">OpenStack使用：自定义实例root密码</div></div></a></div><div class="relatedPosts_item"><a href="/2020/11/07/OpenStack部署：Kolla安装Octavia/" title="OpenStack部署：Kolla安装Octavia"><img class="relatedPosts_cover" src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1604668762480&di=d5583e78d6c7b0388d33ae09d0271f92&imgtype=0&src=http%3A%2F%2Fpic.baike.soso.com%2Fp%2F20140514%2F20140514115311-1438774487.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-07</div><div class="relatedPosts_title">OpenStack部署：Kolla安装Octavia</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 任翌博</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script></div></body></html>